{% extends "base.html" %}

{% block content %}
<h1>Google Sheets Processor</h1>
<select id="sheet-select">
    {% for sheet in sheets %}
    <option value="{{ sheet.id }}">{{ sheet.name }}</option>
    {% endfor %}
</select>
<button id="process-btn">Process Sheet</button>

<div id="sheet-entries" style="display: none;">
    <h2>Important Contact Information</h2>
    <table id="entries-table">
        <thead>
            <tr id="table-header"></tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#process-btn').click(function() {
            var sheetId = $('#sheet-select').val();
            $.ajax({
                url: '/process',
                method: 'POST',
                data: { sheet_id: sheetId },
                success: function(response) {
                    console.log("Received data:", response);
                    displaySheetEntries(response);
                },
                error: function(error) {
                    console.error('Error processing sheet:', error);
                }
            });
        });
    });

    function displaySheetEntries(data) {
        var $tableHeader = $('#table-header');
        var $tableBody = $('#table-body');
        
        $tableHeader.empty();
        $tableBody.empty();

        // Add table headers
        if (data.length > 0) {
            Object.keys(data[0]).forEach(function(key) {
                $tableHeader.append('<th>' + key.replace(/_/g, ' ') + '</th>');
            });
        }

        // Add table rows
        data.forEach(function(entry) {
            var $row = $('<tr>');
            Object.values(entry).forEach(function(value) {
                $row.append('<td>' + value + '</td>');
            });
            $tableBody.append($row);
        });

        $('#sheet-entries').show();
    }
</script>
{% endblock %}